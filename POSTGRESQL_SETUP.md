# PostgreSQL Setup Guide\n\nComplete guide for setting up PostgreSQL with your SW Inventory system.\n\n## ‚úÖ What's Already Done\n\nYour application is **fully integrated with PostgreSQL**:\n- ‚úÖ Prisma ORM installed and configured\n- ‚úÖ Complete database schema created ([prisma/schema.prisma](prisma/schema.prisma))\n- ‚úÖ Database utility functions ([src/lib/server/db.ts](src/lib/server/db.ts))\n- ‚úÖ All routes updated to use Prisma queries (no more mock data!)\n- ‚úÖ Prisma Client generated and ready to use\n\n## What You Need To Do\n\nYou just need to **set up a PostgreSQL database** and run the migrations. Here are your options:\n\n---\n\n## Option 1: Local PostgreSQL (Recommended for Development)\n\n### Install PostgreSQL\n\n**Windows:**\n1. Download from https://www.postgresql.org/download/windows/\n2. Run installer (default settings work fine)\n3. Remember the password you set for `postgres` user\n\n**Mac (using Homebrew):**\n```bash\nbrew install postgresql@16\nbrew services start postgresql@16\n```\n\n**Linux (Ubuntu/Debian):**\n```bash\nsudo apt update\nsudo apt install postgresql postgresql-contrib\nsudo systemctl start postgresql\n```\n\n### Create Database\n\n```bash\n# Connect to PostgreSQL\npsql -U postgres\n\n# Create database\nCREATE DATABASE sw_inventory;\n\n# Create user (optional but recommended)\nCREATE USER sw_user WITH ENCRYPTED PASSWORD 'your_password';\nGRANT ALL PRIVILEGES ON DATABASE sw_inventory TO sw_user;\n\n# Exit\n\q\n```\n\n### Update .env File\n\nThe `.env` file is already configured. Just update if your credentials are different:\n\n```env\nDATABASE_URL="postgresql://postgres:postgres@localhost:5432/sw_inventory?schema=public"\n```\n\nOr if you created a custom user:\n```env\nDATABASE_URL="postgresql://sw_user:your_password@localhost:5432/sw_inventory?schema=public"\n```\n\n### Run Migrations\n\n```bash\n# Push the schema to your database\nnpx prisma db push\n\n# Optional: Open Prisma Studio to view your database\nnpx prisma studio\n```\n\n---\n\n## Option 2: Docker Compose (Easiest!)\n\n### Create docker-compose.yml\n\n```yaml\nversion: '3.8'\n\nservices:\n  postgres:\n    image: postgres:16-alpine\n    container_name: sw_inventory_db\n    environment:\n      POSTGRES_USER: sw_user\n      POSTGRES_PASSWORD: sw_password\n      POSTGRES_DB: sw_inventory\n    ports:\n      - "5432:5432"\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    healthcheck:\n      test: ["CMD-SHELL", "pg_isready -U sw_user -d sw_inventory"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\nvolumes:\n  postgres_data:\n```\n\n### Start Database\n\n```bash\n# Start PostgreSQL container\ndocker-compose up -d\n\n# Check if running\ndocker-compose ps\n\n# View logs\ndocker-compose logs -f postgres\n```\n\n### Update .env\n\n```env\nDATABASE_URL="postgresql://sw_user:sw_password@localhost:5432/sw_inventory?schema=public"\n```\n\n### Run Migrations\n\n```bash\nnpx prisma db push\n```\n\n---\n\n## Option 3: Cloud PostgreSQL (For Production)\n\n### Supabase (Free Tier Available)\n\n1. Create account at https://supabase.com\n2. Create new project\n3. Copy connection string from Settings ‚Üí Database\n4. Update `.env` with your connection string:\n\n```env\nDATABASE_URL="postgresql://postgres:[YOUR-PASSWORD]@db.[YOUR-PROJECT].supabase.co:5432/postgres"\n```\n\n### Neon (Serverless PostgreSQL)\n\n1. Create account at https://neon.tech\n2. Create new project\n3. Copy connection string\n4. Update `.env`\n\n### Railway\n\n1. Create account at https://railway.app\n2. New Project ‚Üí Add PostgreSQL\n3. Copy connection string from Variables tab\n4. Update `.env`\n\n---\n\n## Verify Database Connection\n\nAfter setting up, verify everything works:\n\n```bash\n# Test connection\nnpx prisma db pull\n\n# View your database in browser\nnpx prisma studio\n```\n\nThis should open Prisma Studio at http://localhost:5555\n\n---\n\n## Database Schema Overview\n\nYour database has these tables:\n\n### Core Tables\n- **customers** - Multi-tenant customer information\n- **vendors** - Software vendors\n- **software** - Software products with versions\n- **packages** - Software package releases\n- **package_items** - Software items in packages\n- **lpars** - Logical partitions\n- **lpar_software** - Software installed on LPARs\n- **audit_log** - Change tracking\n\n### Key Features\n- ‚úÖ UUID primary keys\n- ‚úÖ JSONB for version history\n- ‚úÖ Foreign key constraints\n- ‚úÖ Indexes for performance\n- ‚úÖ Cascade and restrict delete rules\n- ‚úÖ Automatic timestamps\n\n---\n\n## Seed Sample Data (Optional)\n\nCreate a seed file to add sample data:\n\n```bash\n# Create seed script\ntouch prisma/seed.ts\n```\n\nAdd to `prisma/seed.ts`:\n\n```typescript\nimport { PrismaClient } from '@prisma/client';\n\nconst prisma = new PrismaClient();\n\nasync function main() {\n  // Create a vendor\n  const vendor = await prisma.vendor.create({\n    data: {\n      name: 'IBM',\n      code: 'IBM',\n      website: 'https://www.ibm.com',\n      contactEmail: 'support@ibm.com',\n      active: true\n    }\n  });\n\n  // Create a customer\n  const customer = await prisma.customer.create({\n    data: {\n      name: 'Acme Corporation',\n      code: 'ACME',\n      description: 'Sample customer for testing',\n      active: true\n    }\n  });\n\n  // Create software\n  const software = await prisma.software.create({\n    data: {\n      name: 'CICS Transaction Server',\n      vendorId: vendor.id,\n      description: 'Enterprise transaction processing',\n      currentVersion: 'V5R6M0',\n      currentPtfLevel: 'PTF12345',\n      versionHistory: [],\n      active: true\n    }\n  });\n\n  // Create package\n  const pkg = await prisma.package.create({\n    data: {\n      name: 'Mainframe Suite Q1 2025',\n      code: 'MF-Q1-2025',\n      version: '2025.1.0',\n      description: 'Q1 2025 mainframe software package',\n      releaseDate: new Date('2025-01-15'),\n      active: true,\n      items: {\n        create: [\n          {\n            softwareId: software.id,\n            version: 'V5R6M0',\n            ptfLevel: 'PTF12345',\n            required: true,\n            orderIndex: 1\n          }\n        ]\n      }\n    }\n  });\n\n  // Create LPAR\n  const lpar = await prisma.lpar.create({\n    data: {\n      name: 'Production LPAR 1',\n      code: 'PROD-LPAR-1',\n      customerId: customer.id,\n      description: 'Primary production LPAR',\n      currentPackageId: pkg.id,\n      active: true,\n      softwareInstalled: {\n        create: [\n          {\n            softwareId: software.id,\n            currentVersion: 'V5R6M0',\n            currentPtfLevel: 'PTF12345',\n            installedDate: new Date(),\n            rolledBack: false\n          }\n        ]\n      }\n    }\n  });\n\n  console.log('‚úÖ Seed data created successfully!');\n  console.log({ vendor, customer, software, pkg, lpar });\n}\n\nmain()\n  .catch((e) => {\n    console.error(e);\n    process.exit(1);\n  })\n  .finally(async () => {\n    await prisma.$disconnect();\n  });\n```\n\nUpdate `package.json` to add seed script:\n\n```json\n{\n  "prisma": {\n    "seed": "tsx prisma/seed.ts"\n  }\n}\n```\n\nInstall tsx and run seed:\n\n```bash\nnpm install -D tsx\nnpx prisma db seed\n```\n\n---\n\n## Common Prisma Commands\n\n```bash\n# Push schema changes to database\nnpx prisma db push\n\n# Generate Prisma Client (after schema changes)\nnpx prisma generate\n\n# Open database browser\nnpx prisma studio\n\n# Create a migration (for production)\nnpx prisma migrate dev --name init\n\n# Format your schema file\nnpx prisma format\n\n# Validate schema\nnpx prisma validate\n\n# Reset database (‚ö†Ô∏è deletes all data)\nnpx prisma migrate reset\n```\n\n---\n\n## Application is Ready!\n\nOnce your database is running:\n\n1. **Start the dev server** (if not already running):\n   ```bash\n   npm run dev\n   ```\n\n2. **Open your browser**:\n   ```\n   http://localhost:5173\n   ```\n\n3. **Create your first customer**:\n   - Go to /customers\n   - Click "Add Customer"\n   - Fill out the form\n   - Submit!\n\nThe data will be **saved to your PostgreSQL database** automatically! üéâ\n\n---\n\n## Database Features in Your App\n\n### Automatic Features\n- ‚úÖ **Pagination** - All list pages support pagination\n- ‚úÖ **Search** - Search customers, vendors, software by name/code\n- ‚úÖ **Sorting** - Sort by any column\n- ‚úÖ **Relations** - Automatic joins for related data\n- ‚úÖ **Validation** - Zod schemas validate before database insert\n- ‚úÖ **Audit Logging** - All creates tracked in audit_log table\n- ‚úÖ **Soft Deletes** - Uses active flag instead of deleting\n\n### Implemented Query Features\n- Case-insensitive search\n- Efficient pagination with counts\n- Nested relations (LPAR ‚Üí Customer ‚Üí Package ‚Üí Items)\n- Transaction support (via Prisma)\n- Connection pooling (built-in)\n\n---\n\n## Troubleshooting\n\n### "Can't reach database server"\n```bash\n# Check if PostgreSQL is running\n# Windows:\nservices.msc  # Look for PostgreSQL service\n\n# Mac/Linux:\nps aux | grep postgres\n\n# Docker:\ndocker ps\n```\n\n### "Port 5432 already in use"\n```bash\n# Check what's using the port\n# Windows:\nnetstat -ano | findstr :5432\n\n# Mac/Linux:\nlsof -i :5432\n\n# Change port in DATABASE_URL or stop other PostgreSQL instance\n```\n\n### "Schema out of sync"\n```bash\n# Reset and push again\nnpx prisma db push --force-reset\n```\n\n### "Prisma Client not generated"\n```bash\nnpx prisma generate\n```\n\n---\n\n## Next Steps\n\nNow that PostgreSQL is integrated:\n\n1. **Add More Routes** - Create edit/delete pages for entities\n2. **Add Authentication** - Implement user login/permissions\n3. **Add Validation** - Enhance form validation\n4. **Add Search Filters** - Add advanced filtering options\n5. **Add Reports** - Create dashboard with statistics\n6. **Add API Routes** - Build REST API in `src/routes/api/`\n\n---\n\n## Performance Tips\n\n### Indexes\nThe schema already includes indexes on:\n- Foreign keys\n- Search fields (name, code)\n- Active status\n- Timestamps\n\n### Connection Pooling\nFor production, use PgBouncer or Prisma Accelerate:\n\n```env\n# With connection pooling\nDATABASE_URL="postgresql://user:pass@host:5432/db"\nDIRECT_URL="postgresql://user:pass@host:5432/db"  # For migrations\n```\n\n### Query Optimization\n```typescript\n// ‚úÖ Good: Select only needed fields\nconst customers = await db.customer.findMany({\n  select: { id: true, name: true, code: true }\n});\n\n// ‚ùå Bad: Select everything\nconst customers = await db.customer.findMany();\n```\n\n---\n\n## Support\n\n- **Prisma Docs**: https://www.prisma.io/docs\n- **PostgreSQL Docs**: https://www.postgresql.org/docs/\n- **Your Schema**: [prisma/schema.prisma](prisma/schema.prisma)\n- **Your DB Utils**: [src/lib/server/db.ts](src/lib/server/db.ts)\n\nHappy coding! üöÄ\n